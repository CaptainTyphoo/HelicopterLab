\section{Optimal Control of Pitch/Travel with Feedback (LQ)}\label{sec:prob3}

\subsection{Introducing feedback}\label{sec:prob31}
In Problem 3 the open control loop from Problem 2 had to be closed by adding a feedback loop to the optimal controller. In order to do so the input had to manipulated in the following way:
\begin{equation}
	u_k=u_k^*-K^\top(x_k-x_k^*)
\end{equation}
As long as the helicopter is following the optimal trajectory $x_k^*$ only the optimal input will be applied. If the helicopter deviates from the optimal trajectory countermeasures depending on the matrix $K$ will be taken. The matrix $K$ was calculated by a LQ controller which minimises the quadratic objective funktion $J$ for the linear model:
\begin{equation}
	J=\displaystyle\sum_{i=0}^{\infty} \Delta x_{i+1}^\top Q \Delta x_{i+1} + \Delta u_i^\top R \Delta u_i, \quad Q \geq 0, R >0
\end{equation}
The weighting matrices $Q$ and $R$ will influence the behaviour of the feedback control. Higher values in the $Q$-matrix will punish deviations from the optimal trajectory harder while higher values in the $R$-matrix will punish the usage of the manipulated variable. The optimal $K$-matrix was found by using the \texttt{dqlr}-function from $\mathrm{MATLAB}$. 
\subsection{Results}\label{sec:prob32}
Different values for $Q$ and $R$ were implemented. Some of the results are shown in the Figures (\ref{fig:problem3_LQR[1,0,10,10]}) and (\ref{fig:problem3_LQR[10,1,5,0]}) \\
The best fit to the optimal trajectory could be attained by the weighting displayed in Figure \ref{fig:problem3_LQR[10,1,5,0]}. Due to the closed feedback loop most variations of $Q$ and $R$ remain at the terminal point. Though in some cases there is still some movement of the helicopter visible or the helicopter does not reach the terminal point at all (compare Figure \ref{fig:problem3_LQR[1,0,10,10]}). For most tested variations there appear oscillations in the pitch.An exceptional case can be seen in Figure \ref{Results for $Q=[1,0,10,10]$ and $R=0.5$}. Although the movement in pitch seems to be more controlled in these cases, they are amongst the worst options considering the deviation of the measured traveling from the optimal trajectory.

\subsection{Comparison to Model Predictive Control}\label{sec:prob33}




\begin{figure}[htbp]
	\centering
	\ProblemThreePlot{../MATLAB/Export/problem3_LQR[1,0,10,10].csv}{../MATLAB/Export/problem2plots_q_10_opt.csv}
	\caption{Results for $Q=[1,0,10,10]$ and $R=0.5$}
	\label{fig:problem3_LQR[1,0,10,10]}
\end{figure}


\begin{figure}[htbp]
	\centering
	\ProblemThreePlot{../MATLAB/Export/problem3_LQR[10,1,5,0].csv}{../MATLAB/Export/problem2plots_q_10_opt.csv}
	\caption{Results for $Q=[10,1,5,0]$ and $R=0.5$}
	\label{fig:problem3_LQR[10,1,5,0]}
\end{figure}
